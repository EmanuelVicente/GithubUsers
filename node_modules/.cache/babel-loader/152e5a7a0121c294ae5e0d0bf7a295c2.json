{"ast":null,"code":"import _toConsumableArray from\"/Users/xoor/Desktop/a/exersice/github_users/GithubUsers/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/xoor/Desktop/a/exersice/github_users/GithubUsers/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/xoor/Desktop/a/exersice/github_users/GithubUsers/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{memo,useState,useMemo,useEffect,useCallback}from\"react\";import debounce from\"lodash.debounce\";import{useLazyQuery}from\"@apollo/client\";//Graphql\nimport{searchQueryRepository}from\"../../graphql/query\";//Components\nimport SearchBar from\"./../../components/SearchBar/SearchBar\";import Table from\"./../../components/Table/Table\";//Types\nimport{AlignEnum}from\"../../components/Table/types\";//Styles\nimport{TitleStyled,Container}from\"./styles\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var RepositoriesSearch=function RepositoriesSearch(){var _paginatedData$search5,_paginatedData$search8,_paginatedData$search9,_paginatedData$search10,_paginatedData$search11;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),result=_useState2[0],setResult=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),resultDebounce=_useState4[0],setResultDebounce=_useState4[1];var _useState5=useState({search:{nodes:[]}}),_useState6=_slicedToArray(_useState5,2),paginatedData=_useState6[0],setPaginatedData=_useState6[1];var _useLazyQuery=useLazyQuery(searchQueryRepository),_useLazyQuery2=_slicedToArray(_useLazyQuery,2),getRepositories=_useLazyQuery2[0],data=_useLazyQuery2[1].data;useEffect(function(){var _data$search$pageInfo;if(!data){return;}if(data&&(_data$search$pageInfo=data.search.pageInfo)!==null&&_data$search$pageInfo!==void 0&&_data$search$pageInfo.hasPreviousPage){var _paginatedData$search,_data$search;setPaginatedData({search:_objectSpread(_objectSpread({},data===null||data===void 0?void 0:data.search),{},{nodes:[].concat(_toConsumableArray(((_paginatedData$search=paginatedData.search)===null||_paginatedData$search===void 0?void 0:_paginatedData$search.nodes)||[]),_toConsumableArray(((data===null||data===void 0?void 0:(_data$search=data.search)===null||_data$search===void 0?void 0:_data$search.nodes)||[]).filter(function(value){var _paginatedData$search2;return!(((_paginatedData$search2=paginatedData.search)===null||_paginatedData$search2===void 0?void 0:_paginatedData$search2.nodes)||[]).some(function(valuePaginated){return value.id===valuePaginated.id||!valuePaginated.id;});})))})});}else{setPaginatedData(data||{search:{nodes:[]}});}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[data===null||data===void 0?void 0:data.search]);useEffect(function(){debounce(function(){return setResultDebounce(result);},500)();},[result,resultDebounce]);useEffect(function(){getRepositories({variables:{query:resultDebounce,type:\"REPOSITORY\",first:20}});// eslint-disable-next-line react-hooks/exhaustive-deps\n},[resultDebounce]);var parsedData=useMemo(function(){var _paginatedData$search3,_paginatedData$search4;return(paginatedData===null||paginatedData===void 0?void 0:(_paginatedData$search3=paginatedData.search)===null||_paginatedData$search3===void 0?void 0:(_paginatedData$search4=_paginatedData$search3.nodes)===null||_paginatedData$search4===void 0?void 0:_paginatedData$search4.map(function(node){var updateDate=new Date(node.updatedAt);var createdAt=new Date(node.createdAt);return{id:node.id,data:[{value:node.name,align:AlignEnum.left},{value:node.url,align:AlignEnum.left},{value:node.description,align:AlignEnum.left},{value:\"\".concat(updateDate.getDate(),\"/\").concat(updateDate.getMonth(),\"/\").concat(updateDate.getFullYear()),align:AlignEnum.center},{value:\"\".concat(createdAt.getDate(),\"/\").concat(createdAt.getMonth(),\"/\").concat(createdAt.getFullYear()),align:AlignEnum.center}]||[]};}))||[];},[paginatedData===null||paginatedData===void 0?void 0:(_paginatedData$search5=paginatedData.search)===null||_paginatedData$search5===void 0?void 0:_paginatedData$search5.nodes]);var fetchRepositories=useCallback(function(){var _paginatedData$search6,_paginatedData$search7;getRepositories({variables:{query:resultDebounce,type:\"REPOSITORY\",after:paginatedData===null||paginatedData===void 0?void 0:(_paginatedData$search6=paginatedData.search)===null||_paginatedData$search6===void 0?void 0:(_paginatedData$search7=_paginatedData$search6.pageInfo)===null||_paginatedData$search7===void 0?void 0:_paginatedData$search7.endCursor,first:20}});},[getRepositories,paginatedData===null||paginatedData===void 0?void 0:(_paginatedData$search8=paginatedData.search)===null||_paginatedData$search8===void 0?void 0:(_paginatedData$search9=_paginatedData$search8.pageInfo)===null||_paginatedData$search9===void 0?void 0:_paginatedData$search9.endCursor,resultDebounce]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(SearchBar,{onChangeSearch:setResult}),/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(TitleStyled,{text:\"Repositories\"}),/*#__PURE__*/_jsx(Table,{header:[{value:\"Name\",align:AlignEnum.left},{value:\"Url\",align:AlignEnum.left},{value:\"Description\",align:AlignEnum.left},{value:\"Updated\",align:AlignEnum.left},{value:\"Created\",align:AlignEnum.left}],data:parsedData,nextPage:fetchRepositories,hasMore:(paginatedData===null||paginatedData===void 0?void 0:(_paginatedData$search10=paginatedData.search)===null||_paginatedData$search10===void 0?void 0:(_paginatedData$search11=_paginatedData$search10.pageInfo)===null||_paginatedData$search11===void 0?void 0:_paginatedData$search11.hasNextPage)||false})]})]});};export default/*#__PURE__*/memo(RepositoriesSearch);","map":{"version":3,"names":["React","memo","useState","useMemo","useEffect","useCallback","debounce","useLazyQuery","searchQueryRepository","SearchBar","Table","AlignEnum","TitleStyled","Container","RepositoriesSearch","result","setResult","resultDebounce","setResultDebounce","search","nodes","paginatedData","setPaginatedData","getRepositories","data","pageInfo","hasPreviousPage","filter","value","some","valuePaginated","id","variables","query","type","first","parsedData","map","node","updateDate","Date","updatedAt","createdAt","name","align","left","url","description","getDate","getMonth","getFullYear","center","fetchRepositories","after","endCursor","hasNextPage"],"sources":["/Users/xoor/Desktop/a/exersice/github_users/GithubUsers/src/screens/RepositoriesSearch/RepositoriesSearch.tsx"],"sourcesContent":["import React, { memo, useState, useMemo, useEffect, useCallback } from \"react\";\nimport debounce from \"lodash.debounce\";\nimport { useLazyQuery } from \"@apollo/client\";\n\n//Graphql\nimport {\n  SearchQueryRepositoryProps,\n  SearchQueryRepositoryNodeProps,\n  searchQueryRepository,\n} from \"../../graphql/query\";\n\n//Components\nimport SearchBar from \"./../../components/SearchBar/SearchBar\";\nimport Table from \"./../../components/Table/Table\";\n\n//Types\nimport { AlignEnum } from \"../../components/Table/types\";\n\n//Styles\nimport { TitleStyled, Container } from \"./styles\";\n\nconst RepositoriesSearch = () => {\n  const [result, setResult] = useState<string>(\"\");\n  const [resultDebounce, setResultDebounce] = useState<string>(\"\");\n  const [paginatedData, setPaginatedData] =\n    useState<SearchQueryRepositoryProps>({\n      search: { nodes: [] },\n    });\n\n  const [getRepositories, { data }] = useLazyQuery<SearchQueryRepositoryProps>(\n    searchQueryRepository\n  );\n\n  useEffect(() => {\n    if (!data) {\n      return;\n    }\n    if (data && data.search.pageInfo?.hasPreviousPage) {\n      setPaginatedData({\n        search: {\n          ...data?.search,\n          nodes: [\n            ...(paginatedData.search?.nodes || []),\n            ...(data?.search?.nodes || []).filter(\n              (value) =>\n                !(paginatedData.search?.nodes || []).some(\n                  (valuePaginated) =>\n                    value.id === valuePaginated.id || !valuePaginated.id\n                )\n            ),\n          ],\n        },\n      });\n    } else {\n      setPaginatedData(\n        data || {\n          search: { nodes: [] },\n        }\n      );\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [data?.search]);\n\n  useEffect(() => {\n    debounce(() => setResultDebounce(result), 500)();\n  }, [result, resultDebounce]);\n\n  useEffect(() => {\n    getRepositories({\n      variables: {\n        query: resultDebounce,\n        type: \"REPOSITORY\",\n        first: 20,\n      },\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [resultDebounce]);\n\n  const parsedData = useMemo(\n    () =>\n      paginatedData?.search?.nodes?.map(\n        (node: SearchQueryRepositoryNodeProps) => {\n          const updateDate = new Date(node.updatedAt);\n          const createdAt = new Date(node.createdAt);\n\n          return {\n            id: node.id,\n            data:\n              [\n                {\n                  value: node.name,\n                  align: AlignEnum.left,\n                },\n                {\n                  value: node.url,\n                  align: AlignEnum.left,\n                },\n                {\n                  value: node.description,\n                  align: AlignEnum.left,\n                },\n                {\n                  value: `${updateDate.getDate()}/${updateDate.getMonth()}/${updateDate.getFullYear()}`,\n                  align: AlignEnum.center,\n                },\n                {\n                  value: `${createdAt.getDate()}/${createdAt.getMonth()}/${createdAt.getFullYear()}`,\n                  align: AlignEnum.center,\n                },\n              ] || [],\n          };\n        }\n      ) || [],\n    [paginatedData?.search?.nodes]\n  );\n\n  const fetchRepositories = useCallback(() => {\n    getRepositories({\n      variables: {\n        query: resultDebounce,\n        type: \"REPOSITORY\",\n        after: paginatedData?.search?.pageInfo?.endCursor,\n        first: 20,\n      },\n    });\n  }, [\n    getRepositories,\n    paginatedData?.search?.pageInfo?.endCursor,\n    resultDebounce,\n  ]);\n\n  return (\n    <>\n      <SearchBar onChangeSearch={setResult} />\n      <Container>\n        <TitleStyled text=\"Repositories\" />\n        <Table\n          header={[\n            {\n              value: \"Name\",\n              align: AlignEnum.left,\n            },\n            {\n              value: \"Url\",\n              align: AlignEnum.left,\n            },\n            {\n              value: \"Description\",\n              align: AlignEnum.left,\n            },\n            {\n              value: \"Updated\",\n              align: AlignEnum.left,\n            },\n            {\n              value: \"Created\",\n              align: AlignEnum.left,\n            },\n          ]}\n          data={parsedData}\n          nextPage={fetchRepositories}\n          hasMore={paginatedData?.search?.pageInfo?.hasNextPage || false}\n        />\n      </Container>\n    </>\n  );\n};\n\nexport default memo(RepositoriesSearch);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}